<!-- InputDataCollectionIteration BPEL Process [Generated by the Oracle BPEL Designer]  -->
<process name="InputDataCollectionIteration" targetNamespace="http://emayor.org/InputDataCollectionIteration" suppressJoinFailure="yes" xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/" xmlns:tns="http://emayor.org/InputDataCollectionIteration" xmlns:nsxml1="http://www.emayor.org/eMayorServiceRequest.xsd" xmlns:nsxml2="http://schemas.xmlsoap.org/ws/2003/03/addressing" xmlns:bpelx="http://schemas.oracle.com/bpel/extension" xmlns:task="http://services.oracle.com/bpel/task" xmlns:ora="http://schemas.oracle.com/xpath/extension" xmlns:nsxml0="http://services.oracle.com/bpel/task"><!-- ================================================================= --><!-- PARTNERLINKS                                                      --><!-- List of services participating in this BPEL process               --><!-- ================================================================= -->
 <partnerLinks><!--
        The 'client' role represents the requester of this service. It is 
        used for callback. The location and correlation information associated
        with the client role are automatically set using WS-Addressing.
        -->
  <partnerLink name="client" partnerLinkType="tns:InputDataCollectionIteration" myRole="InputDataCollectionIterationProvider" partnerRole="InputDataCollectionIterationRequester"/>
  <partnerLink name="UserInteractionManager" partnerLinkType="task:TaskManager" partnerRole="TaskManager" myRole="TaskManagerRequester"/>
 </partnerLinks><!-- ================================================================= --><!-- VARIABLES                                                         --><!-- List of messages and XML documents used within this BPEL process  --><!-- ================================================================= -->
 <variables><!-- Reference to the message passed as input during initiation -->
  <variable name="input" messageType="tns:InputDataCollectionIterationRequestMessage"/><!-- Reference to the message that will be sent back to the 
             requester during callback
             -->
  <variable name="output" messageType="tns:InputDataCollectionIterationResponseMessage"/>
  <variable name="requestData" element="tns:InputDataCollectionIterationRequest"/>
 </variables><!-- ================================================================= --><!-- ORCHESTRATION LOGIC                                               --><!-- Set of activities coordinating the flow of messages across the    --><!-- services integrated within this business process                  --><!-- ================================================================= -->
 <sequence name="main"><!-- Receive input from requestor. 
             Note: This maps to operation defined in InputDataCollectionIteration.wsdl 
             -->
  <receive name="receiveInput" partnerLink="client" portType="tns:InputDataCollectionIteration" operation="initiate" variable="input" createInstance="yes"/><!-- Asynchronous callback to the requester.
             Note: the callback location and correlation id is transparently handled 
             using WS-addressing.
             -->
  <scope name="scope-1" variableAccessSerializable="no">
   <variables>
    <variable name="UserInteractionTask" element="task:task"/>
   </variables>
   <sequence>
    <assign name="configureTask"><!-- Assign 'title' in task document --><!-- Assign 'creator' in task document --><!-- Assign 'assignee' in task document --><!-- Assign 'duration' in task document --><!-- Assign 'priority' in task document --><!-- Assign 'attachment' in task document --><!-- for the signature !-->
     <copy>
      <from expression="string( 'data collection' )"/>
      <to variable="UserInteractionTask" query="/task:task/task:title"/>
     </copy>
     <copy>
      <from expression="string( 'InputDataCollectionIteration' )"/>
      <to variable="UserInteractionTask" query="/task:task/task:creator"/>
     </copy>
     <copy>
      <from variable="input" part="payload" query="/tns:InputDataCollectionIterationRequest/nsxml1:uid"/>
      <to variable="UserInteractionTask" query="/task:task/task:assignee"/>
     </copy>
     <copy>
      <from expression="string( 'PT1H' )"/>
      <to variable="UserInteractionTask" query="/task:task/task:duration"/>
     </copy>
     <copy>
      <from variable="input" part="docType" query="/tns:DocumentType"/>
      <to variable="UserInteractionTask" query="/task:task/task:priority"/>
     </copy>
     <copy>
      <from variable="input" part="payload" query="/tns:InputDataCollectionIterationRequest/nsxml1:reqestDocument"/>
      <to variable="UserInteractionTask" query="/task:task/task:attachment"/>
     </copy>
     <copy>
      <from variable="input" part="payload" query="/tns:InputDataCollectionIterationRequest/nsxml1:ssid"/>
      <to variable="UserInteractionTask" query="/nsxml0:task/nsxml0:title"/>
     </copy>
     <copy>
      <from variable="input" part="payload" query="/tns:InputDataCollectionIterationRequest"/>
      <to variable="output" part="payload" query="/tns:InputDataCollectionIterationResponse"/>
     </copy>
     <copy>
      <from variable="input" part="payload" query="/tns:InputDataCollectionIterationRequest/nsxml1:reqDocDigSig"/>
      <to variable="UserInteractionTask" query="/nsxml0:task/nsxml0:customKey"/>
     </copy>
     <copy>
      <from variable="input" part="payload" query="/tns:InputDataCollectionIterationRequest/nsxml1:status"/>
      <to variable="UserInteractionTask" query="/nsxml0:task/nsxml0:conclusion"/>
     </copy>
    </assign>
    <scope name="UserInteractionUserInteraction" variableAccessSerializable="no">
     <variables>
      <variable name="taskRequest" messageType="task:taskMessage"/>
      <variable name="taskResponse" messageType="task:taskMessage"/>
     </variables>
     <sequence><!-- Assign task document to taskMessage -->
      <assign name="setPayload">
       <copy>
        <from variable="UserInteractionTask"/>
        <to variable="taskRequest" part="payload"/>
       </copy>
      </assign><!--  initiate task -->
      <invoke name="initiateTask" partnerLink="UserInteractionManager" portType="nsxml0:TaskManager" operation="initiateTask" inputVariable="taskRequest"/><!--  Receive the outcome of the task -->
      <receive name="receiveTaskResult" partnerLink="UserInteractionManager" portType="nsxml0:TaskManagerCallback" operation="onTaskResult" variable="taskResponse" createInstance="no"/><!-- Read task document from taskMessage -->
      <assign name="readPayload">
       <copy>
        <from variable="taskResponse" part="payload"/>
        <to variable="UserInteractionTask"/>
       </copy>
      </assign>
     </sequence>
    </scope>
    <assign name="configureOutput">
     <copy>
      <from variable="UserInteractionTask" query="/nsxml0:task/nsxml0:attachment"/>
      <to variable="output" part="payload" query="/tns:InputDataCollectionIterationResponse/nsxml1:reqestDocument"/>
     </copy>
     <copy>
      <from variable="UserInteractionTask" query="/nsxml0:task/nsxml0:customKey"/>
      <to variable="output" part="payload" query="/tns:InputDataCollectionIterationResponse/nsxml1:reqDocDigSig"/>
     </copy>
     <copy>
      <from variable="UserInteractionTask" query="/task:task/task:modifier"/>
      <to variable="output" part="payload" query="/tns:InputDataCollectionIterationResponse/nsxml1:uid"/>
     </copy>
    </assign>
   </sequence>
  </scope>
  <invoke name="callbackClient" partnerLink="client" portType="tns:InputDataCollectionIterationCallback" operation="onResult" inputVariable="output"/>
 </sequence>
</process>
